<style>
.leaflet-container {  /* all maps */
  width:  100%;
  height: calc(100% - 100px);
}
label[for="id_geom"] { display:none; }
</style>
{% load leaflet_tags %}
<html>
  <head>
   {% leaflet_js plugins="forms" %}
   {% leaflet_css plugins="forms" %}
   <script type="text/javascript">
    window.addEventListener("map:init", function (event) {
      var map = event.detail.map;
      var style = {
        "stroke": true,
        "weight": 2,
        "color": "#666666",
        "fillColor": "#ffcccc",
        "opacity": 0.8,
        "fillOpacity": 0.2,
      };
      var sector_style = {
        "fillColor": "#ff9966",
        "color": "#ff9966"
      };
      var polygon = L.geoJSON({% autoescape off %}{{ canvas_area.geom.json }}{% endautoescape %}, style).addTo(map);
      // zoom the map to the polygon
      map.fitBounds(polygon.getBounds());
      {% for parcel in parcels %}
      var parcel = L.geoJSON({% autoescape off %}{{ parcel.geom.json }}{% endautoescape %}, style).addTo(map);
      {% endfor %}
      {% for sector in sectors %}
      var sector = L.geoJSON({% autoescape off %}{{ sector.geom.json }}{% endautoescape %}, sector_style).addTo(map);
        var canvasser_names = [];
        {% for canvasser in sector.canvassers.all %}
        canvasser_names.push('{{ canvasser.first_name }} {{ canvasser.last_name }}');
        {% endfor %}
        var canvasser_names_str = canvasser_names.join(', ');
        sector.bindTooltip(canvasser_names_str,
                 {permanent: true, direction:"center"}
                   ).openTooltip()

      {% endfor %}
    });
  </script>
  </head>
  <body>
    <form action="" method="POST">
        {% csrf_token %}
        {{ form }}
        <input type="submit" value="Submit"/>
    </form>
    <div class="overlay">
    <a class='btn' href="{% url 'canvas-details' canvas_id=canvas_id %}">Complete</a>
    <a class='btn' href="{% url 'index' %}">Home</a>
    </div>
  </body>
</html>
